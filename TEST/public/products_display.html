<script>
</script>
<script>//template taken from W3Schools and modified</script>
<!DOCTYPE html>
<html>
<title>Shopping for GPU</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="products-style.css">
<script src="./functions.js"></script>
<script>
  // get the query string
  var products_data;
  var total = 0;
  loadJSON("products_data", function (response) {
      // Parsing JSON string into object
      products_data = JSON.parse(response);
  });
  console.log(products_data)
  loadJSON('get_cart', function (response) {
      // Parsing JSON string into object
      shopping_cart = JSON.parse(response);
      cart = response
      for (pk in shopping_cart) {
          total += shopping_cart[pk].reduce((a, b) => a + b);
      }
  });
  loadJSON(user_data, function (response) {
      // Parsing JSON string into object
      user_reg_data = JSON.parse(response);
  });
  

  // get the query string
  let params = (new URL(document.location)).searchParams;
  if (params.has('products_key')) {
      var this_product_key = params.get('products_key');
  } else {
      window.location.href = "./index.html";
  }
</script>


<!-- Image header taken from w3schools --> 
  <div class="w3-display-container w3-container">
    <img src="/images/3080.jpg" alt="Graphic Cards" style="width:100%">
    <div class="w3-display-topleft w3-text-white" style="padding:24px 48px">
      <h1 class="w3-jumbo w3-hide-small">New arrivals</h1>
      <h1 class="w3-hide-large w3-hide-medium">New arrivals</h1>
      <p><a href="#products" class="w3-button w3-black w3-padding-large w3-large">SHOP NOW</a></p>
    </div>
  </div>
  <!-- Nav Bar taken from W3SCHOOLS -->
  <div class="navbar">
    <a href="index.html">Home</a>
    <a href="/login">Login/Register</a>
    <div class="dropdown">
      <button class="dropbtn">Products
        <i class="fa fa-caret-down"></i>
      </button>
      <div class="dropdown-content">
        <script>
        nav_bar(this_product_key, products_data)
      </script>
      </div>
    </div> 
  </div>
  
  <form name = "product_main_display" action="/process_form" method="POST">
    <div class="w3-container w3-text-grey" id="products">
      <p>6 items</p>
      <h1>RTX 30 Series Graphic Card Models</h1>
      <script>
        //Using master array to make the products display which also put in input for the amount I would want to purchase this includes adding a purhcase button on the bottom.
    for(i= 0; i <products.length; i++) {
      document.write(`<section class = "item">
          <h2>${products[i].model}</h2>
          <p>$${products[i].price}</p>
          <label id="quantity${i}_label">Quantity:</label>
          <b>${products[i].quantity_available}</b>
          <input type="text" placeholder="0" name="quantity${i}">
          <img src="./images/${products[i].image}">      
          </section>`)
  }      
  var order_str = '';
    // get the particular products to display
    products = products_data[this_product_key];
    console.log(products_data[products])
    if (params.has('Submit')) {
        // grab the quantities from the query string
        order_str = 'Your order is:<br>';
        for (i = 0; i < products.length; i++) {
            order_str += `You want ${params.get(`quantities[${i}]`)} of ${products[i]['name']}<br>`;
        }
      }
           document.write(order_str);
   </script>
    </div>
    <input type ="submit"  id="submit_purchase"> 
    </form>
</body>
</html>
